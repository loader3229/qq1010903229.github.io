<!doctype html>
<html lang="zh-cn">
<head>
<meta charset="utf-8">
<title>香澄的1.0版自我介绍</title>
<script type="text/javascript">
localStorage.l2dm = localStorage.l2dm || "/kasumievent130.json";

String.prototype.replaceAll = function (targetStr, newStr) {
  var sourceStr = this.valueOf();
  while (sourceStr.indexOf(targetStr) !== -1) {
    sourceStr = sourceStr.replace(targetStr, newStr);
  }
  return sourceStr;
};
var text={"type":"Live2D Model Setting",
"name":"kasumi",
"model":"",
"textures":[""],
"physics":"",
"expressions":[{"name":"default","file":document.location.origin+"/ksm/selfintroduction/default.exp.json"}],
"motions":{
"testmotion":[{"file":document.location.origin+"/ksm/selfintroduction/smile02.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}],
"p1":[{"file":document.location.origin+"/ksm/selfintroduction/smile01.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}],
"p1a":[{"file":document.location.origin+"/ksm/selfintroduction/nf04.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}],
"p2":[{"file":document.location.origin+"/ksm/selfintroduction/smile01.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}],
"p3":[{"file":document.location.origin+"/ksm/selfintroduction/serious01.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}],
"p4":[{"file":document.location.origin+"/ksm/selfintroduction/smile02.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}],
"p5":[{"file":document.location.origin+"/ksm/selfintroduction/shame01.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}],
"p6":[{"file":document.location.origin+"/ksm/selfintroduction/smile01.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}],
"p7":[{"file":document.location.origin+"/ksm/selfintroduction/nf05.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}],
"p8":[{"file":document.location.origin+"/ksm/selfintroduction/smile02.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}],
"p9":[{"file":document.location.origin+"/ksm/selfintroduction/jaan01.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}],
"p10":[{"file":document.location.origin+"/ksm/selfintroduction/smile01.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}],
"testmotion3":[{"file":document.location.origin+"/ksm/selfintroduction/strange01_16.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}],
"p11":[{"file":document.location.origin+"/ksm/selfintroduction/nf04.mtn","fade_in":1000,"fade_out":1000,"motion_duration":100000}]
}
};
var dialogtexts=["",
"我叫户山香澄。16岁！\n组建了一个名叫Poppin'Party的乐队！",
"成员有贝斯手里美、鼓手沙绫、\n键盘手有咲和吉他手惠惠！",
"我呢、是吉他手兼主唱！",
"小时候，我抬头仰望星空，\n曾经听到了星星的律动",
"它闪闪发光、让人心跳加速，我也希望像它一样！\n我一直都有这样的想法……",
"我看的第一场演唱会非常闪耀夺目，",
"当时我就想，我也要组乐队！",
"所以，现在能和大家一起组成Poppin'Party，我真的非常高兴！",
"因为可以让鲜红的RANDOM STAR“锵锵”地展现出来！",
"真希望大家能来看演唱会呀！",
"我们Poppin'Party\n今后也请多多关照了！",
""];
window.mode="_1";</script>
<script type="text/javascript">
var bgm=new Audio();bgm.src="bgm.mp3";var modelloaded=0;var resloaded=0;var inited=0;
var width=800,height=800,s=2,running=2,aud=new Audio();
var ti=0;
var currentstate=0;
var lipSyncValues={};
var changetime=[0,5288,6006,2444,6006,5828,3452,3380,4784,3416,2588,5308];
window.rdialog=function(){
return "";
};
function loadwidget(){
var script=document.createElement("script");
script.type="text/javascript";
script.src="widget.js";
document.body.appendChild(script);
}
function update(){
if(!document.createElement('canvas').getContext || navigator.userAgent.indexOf("Trident")!=-1 || navigator.userAgent.indexOf("MSIE")!=-1){
nocanvas.style.display="inline";
return;
}
if(resloaded<36){
resloading.style.display="inline";
resloading2.innerHTML=resloaded;
return;
}
resloading2.innerHTML=resloaded;
if(!window.l2dready)return;
if(resloaded<37){
setTimeout(loadwidget,100);
resloaded=37;
return;
}
if(!window.L2Dwidget)return;
if(inited==0)setTimeout("L2Dwidget.init({display:{superSample:"+s+",width:"+width+",height:"+height+"},mobile:{show:true,scale:0.5},model:{scale:0.5}});",200);
inited=1;
if(!window.l2de){
resloading.style.display="inline";
resloading2.innerHTML=resloaded;
return;
}
if(running==2)running=0;
resloading.style.display="none";
imgplaceholder.style.display="none";
window.l2de&&window.l2de.setLipSync(null);
var arr=lipSyncValues[currentstate];
if(arr){
var index=Math.floor((Date.now()-ti)/50);
if(arr[index])window.l2de&&window.l2de.setLipSyncValue(arr[index]);
else window.l2de&&window.l2de.setLipSyncValue(0);
}
start_link.style="";
if(running==0)start_link3.style="";
if(modelloaded==0)modelloaded=1,setTimeout('start_test();',500);
if(bgm.paused)bgm.play();
if(clipl2d.checked){
document.getElementById("clip").innerHTML="#live2d-widget{clip:rect(171px,800px,651px,0);}";
}else document.getElementById("clip").innerHTML="";
if(showdialog.checked){
document.getElementById("showdialog1").innerHTML="";
}else document.getElementById("showdialog1").innerHTML="#dialog1,#dialog2{display:none;}";

if(running==1){
document.getElementById("status").innerHTML="当前状态："+currentstate+"<br>时间："+(Date.now()-ti)+"/"+changetime[currentstate];
}else{
document.getElementById("status").innerHTML="当前状态：停止";
}

//next state

if(running==1)dialog2.innerHTML=dialogtexts[currentstate].slice(0,Math.floor((Date.now()-ti)/80)).replaceAll("\n","<br>");
if(running==1&&Date.now()-ti>changetime[currentstate]){
currentstate++;
dialog2.innerHTML="";dialogtexts[currentstate];
ti=Date.now();
if(currentstate==12){
running=0;
currentstate=0;
start_link3.style="";
}
aud.src=currentstate+".mp3";
aud.play();
if(currentstate!=9)window.l2de&&window.l2de.startMotion("p"+currentstate,0);
if(currentstate==1)setTimeout("window.l2de&&window.l2de.startMotion('p1a',0);",2500);
if(currentstate==9)setTimeout("window.l2de&&window.l2de.startMotion('p9',0);",700);
}

}
setInterval(update,20);
setInterval("document.getElementById('live2d-widget')&&(document.getElementById('live2d-widget').style='')",300);
function start(){
if(running)return;
if(window.l2de===undefined)return;
ti=Date.now();
if(bgm.paused)bgm.play();
aud.play();
running=1;
start_link3.style.display="none";
}
function start_test(){
if(running)return;
if(window.l2de===undefined)return;
window.l2de&&window.l2de.startMotion("testmotion",0);
}
function start_test3(){
if(running)return;
if(window.l2de===undefined)return;
window.l2de&&window.l2de.startMotion("testmotion3",0);
}
function getLSV(a){
var xhr=new XMLHttpRequest();
xhr.onreadystatechange=(function(xhr,a){
if(xhr.readyState==4 && xhr.status == 200){
resloaded++;
var resp=xhr.responseText.split("\n");
var result=[];
for(var i=1;i<resp.length;i++){
if(result[Math.floor(i/50)]===undefined)result[Math.floor(i/50)]=0;
var temp=parseFloat(resp[i]);
if(temp!=temp)temp=0;
result[Math.floor(i/50)]+=(temp/13);
}
result.push(0);
lipSyncValues[a]=result;
}
}).bind(null,xhr,a);
xhr.open("GET",a+".txt",true);
xhr.send();
}
function getres(a){
var xhr=new XMLHttpRequest();
xhr.onreadystatechange=(function(xhr,a){
if(xhr.readyState==4 && xhr.status == 200){
resloaded++;
}
if(xhr.readyState==4 && xhr.status != 200){
alert("Cannot load "+a);
}
}).bind(null,xhr,a);
xhr.open("GET",a,true);
xhr.send();
}
getLSV("1");
getLSV("2");
getLSV("3");
getLSV("4");
getLSV("5");
getLSV("6");
getLSV("7");
getLSV("8");
getLSV("9");
getLSV("10");
getLSV("11");
getres("1.mp3");
getres("2.mp3");
getres("3.mp3");
getres("4.mp3");
getres("5.mp3");
getres("6.mp3");
getres("7.mp3");
getres("8.mp3");
getres("9.mp3");
getres("10.mp3");
getres("11.mp3");
getres("bgm.mp3");
getres("default.exp.json");
getres("smile01.mtn");
getres("smile02.mtn");
getres("serious01.mtn");
getres("shame01.mtn");
getres("strange01_16.mtn");
getres("nf04.mtn");
getres("nf05.mtn");
getres("jaan01.mtn");
getres("widget.js");

var json_xhr=new XMLHttpRequest();
json_xhr.onreadystatechange=(function(json_xhr,a){
if(json_xhr.readyState==4 && json_xhr.status == 200){
resloaded++;
var tmp=JSON.parse(json_xhr.responseText);
text.model=document.location.origin+"/"+tmp.model;
text.physics=document.location.origin+"/"+tmp.physics;
text.textures[0]=document.location.origin+"/"+tmp.textures[0];
getres(text.model);
getres(text.physics);
getres(text.textures[0]);
console.log(text);
window.l2dmodelpath="data:application/json;base64,"+btoa(JSON.stringify(text));
window.l2dready=true;
}
if(json_xhr.readyState==4 && json_xhr.status != 200){
alert("Cannot load "+a);
}
}).bind(null,json_xhr,localStorage.l2dm);
json_xhr.open("GET",localStorage.l2dm,true);
json_xhr.send();
</script>
<style>
#imgplaceholder{clip:rect(171px,800px,651px,0);}
#live2d-widget,#imgplaceholder{
pointer-events:none;
position:absolute;
width:800px;
height:800px;
opacity:1;
left:88px;
top:-163px;
}
#dialog1{
left:58px;
top:298px;
position:absolute;
border-style:solid;
border-width:2px;
border-color:#ffffff;
padding:10px;
background-color:#ff3b72;
color:#ffffff;
width:200px;
z-index:3;
}
#dialog2{
position:absolute;
left:58px;
top:338px;
padding:10px;
background-color:#ffffff;
opacity:0.8;
width:840px;
height:80px;
z-index:2;
}
#nocanvas{
display:none;
}
</style>
<style id="clip"></style>
<style id="showdialog1"></style>
</head>
<body>
<div style="position:absolute;left:8px;top:8px;background:url(bg1.png);background-position:-47px -157px;background-size:1056px 792px;width:960px;height:480px;">
<div style="background-color:rgba(255,255,255,0.6);">
<a id="start_link" style="display:none;" href="javascript:start();">开始自我介绍</a> <a id="start_link3" style="display:none;" href="javascript:start_test3();">让香澄模仿丸山彩</a><noscript>请打开javascript</noscript><span id="nocanvas">你的浏览器不支持HTML5 canvas</span><span id="resloading" style="display:none;">加载中... (<span id="resloading2"></span>/38)</span><br>
<span style="display:none;"><input id="clipl2d" name="clipl2d" type="checkbox" checked></input><label for="clipl2d">裁剪live2d模型</label><br></span>
<input id="showdialog" name="showdialog" type="checkbox" checked></input><label for="showdialog">显示对话框</label>
<br>
<!--若要切换本页面中户山香澄的服装，请在<a href="/bandoril2dsettings.html">这里</a>进行设置-->
<a href="/bandoril2dsettings.html">切换本页面中户山香澄的服装</a>
<br>
这是户山香澄的1.0版自我介绍。
<br>
<div id="status" style="">
如果加载进度一直卡在37/38，请<a href="javascript:loadwidget();">点击这里</a>
</div>
</div>
</div>
<div id="dialog1">香澄</div>
<div id="dialog2"></div>
<img id="imgplaceholder" src="placeholder.png">
</body>
</html>